<div class="slide">
            <h2><span class="emoji">‚ö°</span>Indexa√ß√£o e Performance</h2>
            
            <div class="concept-box">
                <p style="font-size: 1.2rem; margin-bottom: 20px;">
                    <span class="highlight">√çndices</span> s√£o fundamentais para consultas r√°pidas em grandes volumes de dados!
                </p>
            </div>

            <div class="code-container">
                <div class="code-title">üìà Criando √çndices Essenciais</div>
                <pre><code class="language-javascript">// √çndice simples (campo √∫nico)
db.alunos.createIndex({ nome: 1 })
db.alunos.createIndex({ idade: -1 })
db.alunos.createIndex({ data_matricula: -1 })

// √çndice composto (m√∫ltiplos campos)
db.alunos.createIndex({ curso_id: 1, ativo: 1 })
db.alunos.createIndex({ ativo: 1, idade: -1 })

// √çndice de texto para busca textual
db.alunos.createIndex({ nome: "text", curso: "text" })

// √çndice esparso (s√≥ para docs que t√™m o campo)
db.alunos.createIndex({ telefone: 1 }, { sparse: true })

// √çndice com TTL (expira documentos automaticamente)
db.logs.createIndex({ data_criacao: 1 }, { expireAfterSeconds: 86400 }) // 24h

// √çndice √∫nico (garante unicidade)
db.alunos.createIndex({ email: 1 }, { unique: true })</code></pre>
            </div>

            <div class="two-column">
                <div>
                    <div class="code-container">
                        <div class="code-title">üîç Analisando Performance</div>
                        <pre><code class="language-javascript">// Ver plano de execu√ß√£o detalhado
db.alunos.find({ idade: { $gt: 20 } })
  .explain("executionStats")

// Verificar √≠ndices existentes
db.alunos.getIndexes()

// Estat√≠sticas de uso de √≠ndices
db.alunos.aggregate([
  { $indexStats: {} }
])

// Verificar se consulta usa √≠ndice
db.alunos.find({ nome: "Jo√£o" })
  .hint({ nome: 1 })  // for√ßar uso do √≠ndice</code></pre>
                    </div>
                </div>
                <div>
                    <div class="code-container">
                        <div class="code-title">üßπ Manuten√ß√£o de √çndices</div>
                        <pre><code class="language-javascript">// Remover √≠ndice espec√≠fico
db.alunos.dropIndex({ nome: 1 })

// Remover por nome
db.alunos.dropIndex("nome_1")

// Recriar todos os √≠ndices
db.alunos.reIndex()

// Compactar cole√ß√£o
db.runCommand({ compact: "alunos" })

// Ver tamanho dos √≠ndices
db.alunos.totalIndexSize()</code></pre>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-title">üìä Monitoramento de Performance</div>
                <pre><code class="language-javascript">// Profiler - monitorar consultas lentas
db.setProfilingLevel(2, { slowms: 100 })  // loggar opera√ß√µes > 100ms

// Ver opera√ß√µes lentas
db.system.profile.find().limit(5).sort({ ts: -1 }).pretty()

// Estat√≠sticas da cole√ß√£o
db.alunos.stats()

// Opera√ß√µes atuais
db.currentOp()

// Status do servidor
db.serverStatus().connections</code></pre>
            </div>

            <div class="concept-box">
                <h3>üéØ Estrat√©gias de Indexa√ß√£o:</h3>
                <div class="two-column">
                    <div>
                        <h4 style="color: #4ecdc4; margin-bottom: 15px;">‚úÖ Fazer</h4>
                        <ul>
                            <li>Indexar campos de consulta frequente</li>
                            <li>Usar √≠ndices compostos para consultas m√∫ltiplas</li>
                            <li>Campo mais seletivo primeiro no √≠ndice</li>
                            <li>Monitorar com explain() regularmente</li>
                            <li>Criar √≠ndices em background em produ√ß√£o</li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: #ff6b6b; margin-bottom: 15px;">‚ùå Evitar</h4>
                        <ul>
                            <li>Muitos √≠ndices (impacta writes)</li>
                            <li>√çndices em campos que mudam muito</li>
                            <li>√çndices em cole√ß√µes muito pequenas</li>
                            <li>√çndices duplicados ou redundantes</li>
                            <li>Ignorar o custo de manuten√ß√£o</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 12: Transa√ß√µes e Opera√ß√µes At√¥micas -->
        <div class="slide">
            <h2><span class="emoji">üîí</span>Transa√ß√µes e Opera√ß√µes At√¥micas</h2>
            
            <div class="concept-box">
                <p style="font-size: 1.2rem; margin-bottom: 20px;">
                    <span class="highlight">Transa√ß√µes</span> garantem que m√∫ltiplas opera√ß√µes sejam executadas atomicamente (tudo ou nada).
                </p>
            </div>

            <div class="code-container">
                <div class="code-title">üè¶ Exemplo B√°sico: Transa√ß√£o com IDs Fixos</div>
                <pre><code class="language-javascript">// PROBLEMA: Este c√≥digo falha porque usa IDs placeholder
// ‚ùå N√£o funciona - gera erro BSONError
session = db.getMongo().startSession()

try {
    session.startTransaction()
    
    // ‚ùå ERRO: "turma_atual_id" n√£o √© um ObjectId v√°lido
    db.turmas.updateOne(
        { _id: ObjectId("turma_atual_id") },  // String inv√°lida
        { $pull: { alunos: ObjectId("aluno_id") } },
        { session: session }
    )
    
    session.commitTransaction()
} catch (error) {
    session.abortTransaction()
    print("‚ùå Erro:", error)  // BSONError: input must be a 24 character hex string
} finally {
    session.endSession()
}</code></pre>
            </div>

            <div class="code-container">
                <div class="code-title">‚úÖ Solu√ß√£o Pr√°tica: Transa√ß√£o com Filtros Din√¢micos</div>
                <pre><code class="language-javascript">// ‚úÖ VERS√ÉO CORRETA - Busca din√¢mica por filtros
session = db.getMongo().startSession()

try {
    session.startTransaction()
    
    // 1. Buscar o aluno pelo nome (mais pr√°tico que decorar IDs)
    const aluno = db.alunos.findOne(
        { nome: "Jo√£o Silva" },
        { session: session }
    )
    
    if (!aluno) {
        throw new Error("Aluno n√£o encontrado")
    }
    
    // 2. Buscar a nova turma pelo c√≥digo
    const novaTurma = db.turmas.findOne(
        { codigo: "COMP2024D" },
        { session: session }
    )
    
    if (!novaTurma) {
        throw new Error("Nova turma n√£o encontrada")
    }
    
    // 3. Verificar se h√° vagas dispon√≠veis
    if (novaTurma.vagas_ocupadas >= novaTurma.vagas) {
        throw new Error("N√£o h√° vagas dispon√≠veis na turma de destino")
    }
    
    print(`Transferindo ${aluno.nome} para turma ${novaTurma.codigo}`)
    
    // 4. Executar as opera√ß√µes da transa√ß√£o
    
    // Atualizar dados do aluno
    db.alunos.updateOne(
        { _id: aluno._id },
        { 
            $set: { 
                turma_id: novaTurma._id,
                curso_id: novaTurma.curso_id,
                data_transferencia: new Date()
            }
        },
        { session: session }
    )
    
    // Liberar vaga na turma atual
    db.turmas.updateOne(
        { _id: aluno.turma_id },
        { $inc: { vagas_ocupadas: -1 } },
        { session: session }
    )
    
    // Ocupar vaga na nova turma
    db.turmas.updateOne(
        { _id: novaTurma._id },
        { $inc: { vagas_ocupadas: 1 } },
        { session: session }
    )
    
    // Commit da transa√ß√£o
    session.commitTransaction()
    print("‚úÖ Transfer√™ncia realizada com sucesso!")
    
} catch (error) {
    session.abortTransaction()
    print("‚ùå Erro na transfer√™ncia:", error.message)
} finally {
    session.endSession()
}</code></pre>
            </div>

            <div class="code-container">
                <div class="code-title">üîÑ Fun√ß√£o Reutiliz√°vel para Transfer√™ncias</div>
                <pre><code class="language-javascript">// Fun√ß√£o que pode ser reutilizada com diferentes alunos/turmas
function transferirAluno(nomeAluno, codigoNovaTurma) {
    const session = db.getMongo().startSession()
    
    try {
        session.startTransaction()
        
        // Buscar aluno
        const aluno = db.alunos.findOne(
            { nome: nomeAluno, ativo: true },
            { session: session }
        )
        
        if (!aluno) {
            throw new Error(`Aluno "${nomeAluno}" n√£o encontrado ou inativo`)
        }
        
        // Buscar nova turma
        const novaTurma = db.turmas.findOne(
            { codigo: codigoNovaTurma },
            { session: session }
        )
        
        if (!novaTurma) {
            throw new Error(`Turma "${codigoNovaTurma}" n√£o encontrada`)
        }
        
        // Verificar se n√£o √© a mesma turma
        if (aluno.turma_id.equals(novaTurma._id)) {
            throw new Error("Aluno j√° est√° nesta turma")
        }
        
        // Verificar vagas
        if (novaTurma.vagas_ocupadas >= novaTurma.vagas) {
            throw new Error(`Turma ${codigoNovaTurma} est√° lotada`)
        }
        
        // Executar transfer√™ncia
        db.alunos.updateOne(
            { _id: aluno._id },
            { 
                $set: { 
                    turma_id: novaTurma._id,
                    curso_id: novaTurma.curso_id,
                    data_transferencia: new Date()
                }
            },
            { session: session }
        )
        
        // Atualizar vagas
        db.turmas.updateOne(
            { _id: aluno.turma_id },
            { $inc: { vagas_ocupadas: -1 } },
            { session: session }
        )
        
        db.turmas.updateOne(
            { _id: novaTurma._id },
            { $inc: { vagas_ocupadas: 1 } },
            { session: session }
        )
        
        session.commitTransaction()
        return { success: true, message: "Transfer√™ncia realizada com sucesso!" }
        
    } catch (error) {
        session.abortTransaction()
        return { success: false, message: error.message }
    } finally {
        session.endSession()
    }
}

// Exemplos de uso:
resultado = transferirAluno("Jo√£o Silva", "COMP2024D")
print(resultado.message)

// Mais transfer√™ncias de teste:
transferirAluno("Maria Santos", "PSI2024E")  // Medicina ‚Üí Psicologia
transferirAluno("Carlos Lima", "DIR2024C")   // Engenharia ‚Üí Direito</code></pre>
            </div>

            <div class="two-column">
                <div>
                    <div class="code-container">
                        <div class="code-title">üêç Transa√ß√µes em Python</div>
                        <pre><code class="language-python">from pymongo import MongoClient
from pymongo.errors import PyMongoError

def transferir_aluno(aluno_id, nova_turma_id):
    client = MongoClient()
    
    with client.start_session() as session:
        try:
            with session.start_transaction():
                # Buscar dados atuais
                aluno = client.escola.alunos.find_one(
                    {"_id": aluno_id}, session=session
                )
                
                if not aluno:
                    raise ValueError("Aluno n√£o encontrado")
                
                turma_atual = aluno.get("turma_id")
                
                # Remover da turma atual
                if turma_atual:
                    client.escola.turmas.update_one(
                        {"_id": turma_atual},
                        {"$pull": {"alunos": aluno_id}},
                        session=session
                    )
                
                # Adicionar na nova turma
                client.escola.turmas.update_one(
                    {"_id": nova_turma_id},
                    {"$push": {"alunos": aluno_id}},
                    session=session
                )
                
                # Atualizar aluno
                client.escola.alunos.update_one(
                    {"_id": aluno_id},
                    {
                        "$set": {
                            "turma_id": nova_turma_id,
                            "data_transferencia": datetime.now()
                        }
                    },
                    session=session
                )
            
            return True
            
        except PyMongoError as e:
            print(f"Erro na transa√ß√£o: {e}")
            return False</code></pre>
                    </div>
                </div>
                <div>
                    <div class="code-container">
                        <div class="code-title">‚ö° Opera√ß√µes At√¥micas Simples</div>
                        <pre><code class="language-javascript">// ‚úÖ SINTAXE ATUAL (recomendada)
// findOneAndUpdate - busca e modifica atomicamente
db.alunos.findOneAndUpdate(
    { nome: "Jo√£o Silva" },
    { $inc: { idade: 1 } },
    { returnNewDocument: true }  // retorna documento atualizado
)

// ‚ùå SINTAXE ANTIGA (ainda funciona, mas obsoleta)
// db.alunos.findAndModify({
//     query: { nome: "Jo√£o Silva" },
//     update: { $inc: { idade: 1 } },
//     new: true
// })

// upsert - atualiza ou insere (muito √∫til!)
db.alunos.updateOne(
    { email: "joao@email.com" },
    { 
        $set: { nome: "Jo√£o Silva", idade: 20 },
        $setOnInsert: { data_criacao: new Date() }  // s√≥ insere se criar novo doc
    },
    { upsert: true }  // cria se n√£o existir
)

// Incremento at√¥mico - super seguro para contadores
db.contadores.updateOne(
    { _id: "matriculas" },
    { $inc: { valor: 1 } }  // incrementa automaticamente
)

// Push com limite - mant√©m hist√≥rico limitado
db.alunos.updateOne(
    { nome: "Jo√£o Silva" },  // usando filtro pr√°tico
    {
        $push: {
            historico_notas: {
                $each: [{ nota: 8.5, disciplina: "MongoDB", data: new Date() }],
                $slice: -5  // mant√©m apenas √∫ltimos 5 registros
            }
        }
    }
)</code></pre>
                    </div>
                </div>
            </div>

            <div class="warning">
                <strong>‚ö†Ô∏è Requisitos para Transa√ß√µes:</strong> Transa√ß√µes multi-documento funcionam apenas em replica sets ou clusters sharded. Para desenvolvimento local, use MongoDB como replica set.
            </div>
        </div>

        <!-- Slide 13: Backup e Seguran√ßa -->
        <div class="slide">
            <h2><span class="emoji">üõ°Ô∏è</span>Backup, Seguran√ßa e Boas Pr√°ticas</h2>
            
            <div class="code-container">
                <div class="code-title">üíæ Backup e Restore</div>
                <pre><code class="language-bash"># Backup completo do banco
mongodump --host localhost:27017 --db escola --out /backup/

# Backup de uma cole√ß√£o espec√≠fica
mongodump --host localhost:27017 --db escola --collection alunos --out /backup/

# Backup com compress√£o
mongodump --host localhost:27017 --db escola --gzip --out /backup/

# Restore completo
mongorestore --host localhost:27017 --db escola_restore /backup/escola/

# Restore de cole√ß√£o espec√≠fica
mongorestore --host localhost:27017 --db escola --collection alunos /backup/escola/alunos.bson

# Export para JSON/CSV
mongoexport --host localhost:27017 --db escola --collection alunos --out alunos.json
mongoexport --host localhost:27017 --db escola --collection alunos --type=csv --fields nome,idade,curso --out alunos.csv</code></pre>
            </div>

            <div class="two-column">
                <div>
                    <div class="code-container">
                        <div class="code-title">üîê Configura√ß√£o de Seguran√ßa</div>
                        <pre><code class="language-javascript">// Criar usu√°rio administrador
use admin
db.createUser({
  user: "admin",
  pwd: "senhaSegura123",
  roles: [
    { role: "userAdminAnyDatabase", db: "admin" },
    { role: "readWriteAnyDatabase", db: "admin" }
  ]
})

// Criar usu√°rio espec√≠fico para aplica√ß√£o
use escola
db.createUser({
  user: "app_escola",
  pwd: "senhaApp456",
  roles: [
    { role: "readWrite", db: "escola" }
  ]
})

// Criar usu√°rio apenas leitura
db.createUser({
  user: "relatorios",
  pwd: "senhaRead789",
  roles: [
    { role: "read", db: "escola" }
  ]
})</code></pre>
                    </div>
                </div>
                <div>
                    <div class="code-container">
                        <div class="code-title">üìù Auditoria e Logs</div>
                        <pre><code class="language-javascript">// Habilitar profiling para auditoria
db.setProfilingLevel(1, { slowms: 50 })

// Log de opera√ß√µes de escrita
db.runCommand({
  setParameter: 1,
  logLevel: 2
})

// Verificar conex√µes ativas
db.serverStatus().connections

// Verificar opera√ß√µes atuais
db.currentOp({
  "active": true,
  "secs_running": { "$gt": 5 }
})

// Matar opera√ß√£o lenta
db.killOp(operationId)</code></pre>
                    </div>
                </div>
            </div>

            <div class="concept-box">
                <h3>üîí Checklist de Seguran√ßa:</h3>
                <div class="two-column">
                    <div>
                        <h4 style="color: #4ecdc4; margin-bottom: 15px;">üõ°Ô∏è B√°sico</h4>
                        <ul>
                            <li>‚úÖ Habilitar autentica√ß√£o (--auth)</li>
                            <li>‚úÖ Criar usu√°rios com permiss√µes m√≠nimas</li>
                            <li>‚úÖ Usar senhas fortes</li>
                            <li>‚úÖ Configurar bind_ip adequadamente</li>
                            <li>‚úÖ Habilitar SSL/TLS</li>
                        </ul>
                    </div>
                    <div>
                        <h4 style="color: #4ecdc4; margin-bottom: 15px;">üöÄ Avan√ßado</h4>
                        <ul>
                            <li>‚úÖ Criptografia em repouso</li>
                            <li>‚úÖ Auditoria de opera√ß√µes</li>
                            <li>‚úÖ Backup autom√°tico</li>
                            <li>‚úÖ Monitoramento de performance</li>
                            <li>‚úÖ Firewall e VPN</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-title">üîÑ Script Python para Backup Autom√°tico</div>
                <pre><code class="language-python">import subprocess
import datetime
import os

def backup_automatico():
    """Realiza backup autom√°tico do banco de dados"""
    
    data_atual = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
    pasta_backup = f"/backup/escola_{data_atual}"
    
    try:
        # Comando de backup
        comando = [
            "mongodump",
            "--host", "localhost:27017",
            "--db", "escola",
            "--gzip",
            "--out", pasta_backup
        ]
        
        # Executar backup
        resultado = subprocess.run(comando, capture_output=True, text=True)
        
        if resultado.returncode == 0:
            print(f"‚úÖ Backup realizado com sucesso: {pasta_backup}")
            
            # Remover backups antigos (manter √∫ltimos 7 dias)
            limpar_backups_antigos("/backup/", dias=7)
            
        else:
            print(f"‚ùå Erro no backup: {resultado.stderr}")
            
    except Exception as e:
        print(f"‚ùå Erro ao executar backup: {e}")

def limpar_backups_antigos(pasta, dias=7):
    """Remove backups mais antigos que X dias"""
    import time
    
    agora = time.time()
    limite = agora - (dias * 24 * 60 * 60)
    
    for arquivo in os.listdir(pasta):
        caminho = os.path.join(pasta, arquivo)
        if os.path.isdir(caminho) and arquivo.startswith("escola_"):
            if os.path.getctime(caminho) < limite:
                import shutil
                shutil.rmtree(caminho)
                print(f"üóëÔ∏è Backup removido: {arquivo}")

# Agendar backup di√°rio
if __name__ == "__main__":
    backup_automatico()</code></pre>
            </div>
        </div>

        <div class="slide">
            <h2><span class="emoji">üéì</span>Resumo Final - MongoDB Avan√ßado</h2>
            
            <div class="concept-box">
                <h3>üèÜ Conquistas Desbloqueadas:</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <h4 style="color: #4ecdc4; margin-bottom: 15px;">üîó Relacionamentos</h4>
                        <ul>
                            <li>‚úÖ $lookup entre cole√ß√µes</li>
                            <li>‚úÖ Pipelines de agrega√ß√£o</li>
                            <li>‚úÖ Cruzamento entre bancos</li>
                            <li>‚úÖ Joins complexos</li>
                        </ul>

                        <h4 style="color: #4ecdc4; margin: 20px 0 15px;">üéØ Filtros Avan√ßados</h4>
                        <ul>
                            <li>‚úÖ Operadores de compara√ß√£o</li>
                            <li>‚úÖ Regex e busca textual</li>
                            <li>‚úÖ Filtros de array e datas</li>
                            <li>‚úÖ Valida√ß√£o de dados</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #4ecdc4; margin-bottom: 15px;">üìä Agrega√ß√£o e An√°lise</h4>
                        <ul>
                            <li>‚úÖ Estat√≠sticas complexas</li>
                            <li>‚úÖ Agrupamentos avan√ßados</li>
                            <li>‚úÖ Relat√≥rios din√¢micos</li>
                            <li>‚úÖ Campos calculados</li>
                        </ul>

                        <h4 style="color: #4ecdc4; margin: 20px 0 15px;">üìà Ordena√ß√£o e Pagina√ß√£o</h4>
                        <ul>
                            <li>‚úÖ Sort ASC/DESC m√∫ltiplos</li>
                            <li>‚úÖ Limit e skip otimizados</li>
                            <li>‚úÖ Ranking e top N</li>
                            <li>‚úÖ Pagina√ß√£o eficiente</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #4ecdc4; margin-bottom: 15px;">‚ö° Performance</h4>
                        <ul>
                            <li>‚úÖ Indexa√ß√£o estrat√©gica</li>
                            <li>‚úÖ An√°lise com explain()</li>
                            <li>‚úÖ Monitoramento de consultas</li>
                            <li>‚úÖ Otimiza√ß√£o de pipelines</li>
                        </ul>

                        <h4 style="color: #4ecdc4; margin: 20px 0 15px;">üîí Seguran√ßa</h4>
                        <ul>
                            <li>‚úÖ Transa√ß√µes ACID</li>
                            <li>‚úÖ Backup e restore</li>
                            <li>‚úÖ Controle de acesso</li>
                            <li>‚úÖ Auditoria e logs</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-title">üöÄ Exemplo Final - Pipeline Completo de Produ√ß√£o</div>
                <pre><code class="language-javascript">// Pipeline para relat√≥rio executivo de performance acad√™mica
db.alunos.aggregate([
  // 1. Filtrar dados v√°lidos
  {
    $match: {
      ativo: true,
      notas: { $exists: true, $ne: [] },
      data_matricula: { $gte: new Date("2024-01-01") }
    }
  },
  
  // 2. Adicionar campos calculados
  {
    $addFields: {
      media: { $avg: "$notas" },
      situacao: {
        $switch: {
          branches: [
            { case: { $gte: [{ $avg: "$notas" }, 9] }, then: "Excelente" },
            { case: { $gte: [{ $avg: "$notas" }, 8] }, then: "√ìtimo" },
            { case: { $gte: [{ $avg: "$notas" }, 7] }, then: "Bom" },
            { case: { $gte: [{ $avg: "$notas" }, 6] }, then: "Regular" }
          ],
          default: "Insuficiente"
        }
      },
      tempo_curso: {
        $divide: [
          { $subtract: [new Date(), "$data_matricula"] },
          1000 * 60 * 60 * 24 * 30  // meses
        ]
      }
    }
  },
  
  // 3. Lookup com m√∫ltiplas cole√ß√µes
  {
    $lookup: {
      from: "cursos",
      localField: "curso_id",
      foreignField: "_id",
      as: "curso"
    }
  },
  { $unwind: "$curso" },
  
  {
    $lookup: {
      from: "turmas",
      localField: "turma_id",
      foreignField: "_id",
      as: "turma"
    }
  },
  { $unwind: "$turma" },
  
  // 4. Agrupamento por departamento e situa√ß√£o
  {
    $group: {
      _id: {
        departamento: "$curso.departamento",
        situacao: "$situacao"
      },
      total_alunos: { $sum: 1 },
      media_geral: { $avg: "$media" },
      tempo_medio_curso: { $avg: "$tempo_curso" },
      alunos_detalhes: {
        $push: {
          nome: "$nome",
          curso: "$curso.nome",
          turma: "$turma.codigo",
          media: { $round: ["$media", 2] }
        }
      }
    }
  },
  
  // 5. Estruturar resultado final
  {
    $group: {
      _id: "$_id.departamento",
      situacoes: {
        $push: {
          situacao: "$_id.situacao",
          total: "$total_alunos",
          media: { $round: ["$media_geral", 2] },
          tempo_medio: { $round: ["$tempo_medio_curso", 1] }
        }
      },
      total_departamento: { $sum: "$total_alunos" }
    }
  },
  
  // 6. Ordena√ß√£o final
  { $sort: { total_departamento: -1, _id: 1 } }
])

// üéØ Resultado: Relat√≥rio completo por departamento com todas as m√©tricas!</code></pre>
            </div>

            <div class="concept-box" style="margin-top: 30px;">
                <h3>üéØ Pr√≥xima Jornada - MongoDB Expert:</h3>
                <div class="concept-item">
                    <strong>üì° MongoDB Atlas:</strong> Deploy em nuvem com clusters globais
                </div>
                <div class="concept-item">
                    <strong>üîÑ Change Streams:</strong> Monitoramento em tempo real de mudan√ßas
                </div>
                <div class="concept-item">
                    <strong>üåê Sharding:</strong> Distribui√ß√£o horizontal para milh√µes de documentos
                </div>
                <div class="concept-item">
                    <strong>üîç Full-Text Search:</strong> Busca avan√ßada com MongoDB Atlas Search
                </div>
                <div class="concept-item">
                    <strong>ü§ñ MongoDB Realm:</strong> Sincroniza√ß√£o mobile e edge computing
                </div>
                <div class="concept-item">
                    <strong>üìä MongoDB Charts:</strong> Visualiza√ß√£o de dados integrada
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px; font-size: 1.3rem;">
                <p style="color: #4ecdc4; margin-bottom: 15px;">üéâ <strong>Parab√©ns!</strong> Voc√™ agora √© um(a) MongoDB Developer Avan√ßado(a)!</p>
                <p style="color: #a8d8ff; margin-bottom: 20px;">Dominou CRUD b√°sico ‚Üí CRUD avan√ßado ‚Üí Opera√ß√µes de produ√ß√£o</p>
                <div style="font-size: 2.5rem; margin: 20px 0;">üöÄüíæüî•‚ö°üéì</div>
                <p style="color: #ffd93d; font-size: 1.1rem;">Continue praticando e explorando as funcionalidades avan√ßadas!</p>
            </div>
        </div>

        <!-- Slide 15: Lista de Exerc√≠cios -->
        <div class="slide">
            <h2><span class="emoji">üìù</span>Lista de Exerc√≠cios - Pr√°tica Hands-On</h2>
            
            <div class="concept-box">
                <h3>üéØ 10 Exerc√≠cios: Do Simples ao Complexo</h3>
                <p style="margin-bottom: 20px;">
                    Pratique os conceitos aprendidos com exerc√≠cios progressivos usando <span class="highlight">mongosh</span> e <span class="highlight">PyMongo</span>
                </p>
            </div>

            <div class="concept-box" style="border-left-color: #4ecdc4;">
                <h3>üîß Prepara√ß√£o dos Dados</h3>
                <p>Execute primeiro estes comandos para criar a base de dados dos exerc√≠cios:</p>
                <div class="code-container">
                    <pre><code class="language-javascript">// Dados para os exerc√≠cios
db.alunos.insertMany([
  { nome: "Ana Silva", idade: 20, curso: "Engenharia", notas: [8.5, 9.0, 7.5], cidade: "S√£o Paulo", ativo: true, data_matricula: new Date("2023-03-15") },
  { nome: "Bruno Santos", idade: 22, curso: "Medicina", notas: [9.5, 8.0, 9.0], cidade: "Rio de Janeiro", ativo: true, data_matricula: new Date("2023-02-01") },
  { nome: "Carlos Lima", idade: 19, curso: "Engenharia", notas: [7.0, 6.5, 8.0], cidade: "S√£o Paulo", ativo: false, data_matricula: new Date("2023-01-10") },
  { nome: "Diana Costa", idade: 25, curso: "Direito", notas: [8.0, 9.0, 8.5], cidade: "Belo Horizonte", ativo: true, data_matricula: new Date("2022-08-20") },
  { nome: "Eduardo Rocha", idade: 21, curso: "Computa√ß√£o", notas: [9.0, 9.5, 8.5], cidade: "S√£o Paulo", ativo: true, data_matricula: new Date("2023-04-12") }
])

db.cursos.insertMany([
  { nome: "Engenharia", departamento: "Exatas", duracao: 5, coordenador: "Prof. Silva" },
  { nome: "Medicina", departamento: "Sa√∫de", duracao: 6, coordenador: "Prof. Santos" },
  { nome: "Direito", departamento: "Humanas", duracao: 5, coordenador: "Prof. Lima" },
  { nome: "Computa√ß√£o", departamento: "Exatas", duracao: 4, coordenador: "Prof. Costa" }
])</code></pre>
                </div>
            </div>
        </div>

        <!-- Slide 16: Exerc√≠cios 1-5 -->
        <div class="slide">
            <h2><span class="emoji">ü•â</span>Exerc√≠cios 1-5: N√≠vel Iniciante</h2>
            
            <div class="concept-box">
                <div class="concept-item">
                    <strong>üìù Exerc√≠cio 1:</strong> Listar todos os alunos ativos com idade maior que 20 anos, ordenados por nome.
                    <div style="margin-top: 10px; color: #a8d8ff; font-size: 0.9rem;">
                        <strong>mongosh:</strong> Use find() com filtros e sort()<br>
                        <strong>Python:</strong> Implemente com PyMongo usando filtros e ordena√ß√£o
                    </div>
                </div>

                <div class="concept-item">
                    <strong>üìù Exerc√≠cio 2:</strong> Contar quantos alunos existem por curso e mostrar apenas cursos com mais de 1 aluno.
                    <div style="margin-top: 10px; color: #a8d8ff; font-size: 0.9rem;">
                        <strong>mongosh:</strong> Use aggregate() com $group e $match<br>
                        <strong>Python:</strong> Crie uma fun√ß√£o que retorne um dicion√°rio com o resultado
                    </div>
                </div>

                <div class="concept-item">
                    <strong>üìù Exerc√≠cio 3:</strong> Encontrar todos os alunos cujo nome cont√©m "Silva" (case-insensitive).
                    <div style="margin-top: 10px; color: #a8d8ff; font-size: 0.9rem;">
                        <strong>mongosh:</strong> Use $regex com $options<br>
                        <strong>Python:</strong> Implemente busca por regex usando re (m√≥dulo Python)
                    </div>
                </div>

                <div class="concept-item">
                    <strong>üìù Exerc√≠cio 4:</strong> Calcular a m√©dia geral de notas de todos os alunos ativos.
                    <div style="margin-top: 10px; color: #a8d8ff; font-size: 0.9rem;">
                        <strong>mongosh:</strong> Use aggregate() com $unwind e $group<br>
                        <strong>Python:</strong> Processe os dados e calcule a m√©dia usando statistics.mean()
                    </div>
                </div>

                <div class="concept-item">
                    <strong>üìù Exerc√≠cio 5:</strong> Listar os 3 alunos com maior m√©dia individual, mostrando nome, curso e m√©dia.
                    <div style="margin-top: 10px; color: #a8d8ff; font-size: 0.9rem;">
                        <strong>mongosh:</strong> Use $addFields para calcular m√©dia, depois $sort e $limit<br>
                        <strong>Python:</strong> Calcule m√©dias em mem√≥ria e use sorted() com key personalizada
                    </div>
                </div>
            </div>

            <div class="warning">
                <strong>üí° Dica:</strong> Teste cada exerc√≠cio no MongoDB Compass antes de implementar em Python!
            </div>
        </div>

        <!-- Slide 17: Exerc√≠cios 6-10 -->
        <div class="slide">
            <h2><span class="emoji">ü•á</span>Exerc√≠cios 6-10: N√≠vel Avan√ßado</h2>
            
            <div class="concept-box">
                <div class="concept-item">
                    <strong>üìù Exerc√≠cio 6:</strong> Criar um relat√≥rio completo de alunos por departamento usando lookup entre as cole√ß√µes alunos e cursos.
                    <div style="margin-top: 10px; color: #a8d8ff; font-size: 0.9rem;">
                        <strong>mongosh:</strong> Use $lookup, $group e $project para estruturar o relat√≥rio<br>
                        <strong>Python:</strong> Implemente uma fun√ß√£o que retorne dados estruturados por departamento
                    </div>
                </div>

                <div class="concept-item">
                    <strong>üìù Exerc√≠cio 7:</strong> Encontrar alunos matriculados nos √∫ltimos 6 meses e classific√°-los por faixa de m√©dia (Excelente: ‚â•9, Bom: 7-8.9, Regular: <7).
                    <div style="margin-top: 10px; color: #a8d8ff; font-size: 0.9rem;">
                        <strong>mongosh:</strong> Use filtros de data e $switch para classifica√ß√£o<br>
                        <strong>Python:</strong> Use datetime para filtros e if/elif para classifica√ß√£o
                    </div>
                </div>

                <div class="concept-item">
                    <strong>üìù Exerc√≠cio 8:</strong> Criar um sistema de busca textual que encontre alunos por nome parcial e ordene por relev√¢ncia.
                    <div style="margin-top: 10px; color: #a8d8ff; font-size: 0.9rem;">
                        <strong>mongosh:</strong> Crie √≠ndice de texto e use $text com $meta: "textScore"<br>
                        <strong>Python:</strong> Implemente busca fuzzy usando regex e score personalizado
                    </div>
                </div>

                <div class="concept-item">
                    <strong>üìù Exerc√≠cio 9:</strong> Implementar um sistema de transfer√™ncia de aluno entre cursos usando transa√ß√µes.
                    <div style="margin-top: 10px; color: #a8d8ff; font-size: 0.9rem;">
                        <strong>mongosh:</strong> Use sess√µes e transa√ß√µes para opera√ß√µes at√¥micas<br>
                        <strong>Python:</strong> Implemente com context manager e tratamento de erros
                    </div>
                </div>

                <div class="concept-item">
                    <strong>üìù Exerc√≠cio 10:</strong> Criar um dashboard anal√≠tico completo com: total de alunos, distribui√ß√£o por curso, top 5 m√©dias, alunos por cidade e gr√°fico de matr√≠culas por m√™s.
                    <div style="margin-top: 10px; color: #a8d8ff; font-size: 0.9rem;">
                        <strong>mongosh:</strong> Use $facet para m√∫ltiplas agrega√ß√µes em uma consulta<br>
                        <strong>Python:</strong> Crie classe Dashboard com m√©todos para cada m√©trica e visualiza√ß√£o
                    </div>
                </div>
            </div>

            <div class="success">
                <strong>üöÄ Desafio Extra:</strong> Combine todos os exerc√≠cios em uma aplica√ß√£o web usando Flask/FastAPI + MongoDB!
            </div>
        </div>

        <!-- Slide 18: Gabaritos e Solu√ß√µes -->
        <div class="slide">
            <h2><span class="emoji">‚úÖ</span>Dicas e Estrutura das Solu√ß√µes</h2>
            
            <div class="two-column">
                <div>
                    <h3>üêö Exemplo mongosh (Ex. 1)</h3>
                    <div class="code-container">
                        <pre><code class="language-javascript">// Exerc√≠cio 1: Alunos ativos > 20 anos
db.alunos.find({
  ativo: true,
  idade: { $gt: 20 }
}).sort({ nome: 1 })</code></pre>
                    </div>

                    <h3>üßÆ Exemplo Agrega√ß√£o (Ex. 2)</h3>
                    <div class="code-container">
                        <pre><code class="language-javascript">// Exerc√≠cio 2: Contar por curso
db.alunos.aggregate([
  {
    $group: {
      _id: "$curso",
      total: { $sum: 1 }
    }
  },
  {
    $match: { total: { $gt: 1 } }
  }
])</code></pre>
                    </div>
                </div>
                <div>
                    <h3>üêç Exemplo Python (Ex. 1)</h3>
                    <div class="code-container">
                        <pre><code class="language-python"># Exerc√≠cio 1: Python
from pymongo import MongoClient

client = MongoClient()
db = client.escola

def alunos_ativos_maiores_20():
    resultado = db.alunos.find({
        "ativo": True,
        "idade": {"$gt": 20}
    }).sort("nome", 1)
    
    return list(resultado)

alunos = alunos_ativos_maiores_20()
for aluno in alunos:
    print(f"{aluno['nome']} - {aluno['idade']} anos")</code></pre>
                    </div>

                    <h3>üìä Estrutura Dashboard (Ex. 10)</h3>
                    <div class="code-container">
                        <pre><code class="language-python"># Estrutura do Dashboard
class DashboardEscolar:
    def __init__(self, db):
        self.db = db
    
    def metricas_gerais(self):
        return {
            "total_alunos": self.total_alunos(),
            "por_curso": self.distribuicao_curso(),
            "top_medias": self.top_medias(),
            "por_cidade": self.alunos_por_cidade()
        }
    
    def total_alunos(self):
        # Implementar contagem
        pass
    
    # ... outros m√©todos</code></pre>
                    </div>
                </div>
            </div>

            <div class="concept-box">
                <h3>üéØ Como Abordar os Exerc√≠cios:</h3>
                <ul>
                    <li><strong>1. Planejamento:</strong> Entenda o que o exerc√≠cio pede antes de programar</li>
                    <li><strong>2. mongosh primeiro:</strong> Teste as consultas no shell antes do Python</li>
                    <li><strong>3. Valida√ß√£o:</strong> Confira se os resultados fazem sentido</li>
                    <li><strong>4. Otimiza√ß√£o:</strong> Use explain() para verificar performance</li>
                    <li><strong>5. Documenta√ß√£o:</strong> Comente seu c√≥digo explicando a l√≥gica</li>
                </ul>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <p style="color: #4ecdc4; font-size: 1.2rem;">üí™ <strong>Hora de praticar!</strong></p>
                <p style="color: #a8d8ff;">Resolva os exerc√≠cios para consolidar seu conhecimento MongoDB</p>
            </div>
        </div>
    </div>

    <!-- Navega√ß√£o -->
    <div class="navigation">
        <button class="nav-btn" id="prevBtn" onclick="changeSlide(-1)">‚Üê Anterior</button>
        <button class="nav-btn" id="nextBtn" onclick="changeSlide(1)">Pr√≥ximo ‚Üí</button>
    </div>

    <!-- Contador de slides -->
    <div class="slide-counter">
        <span id="slideCounter">1 / 17</span>
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;

        function showSlide(n) {
            // Remove active class from all slides
            slides.forEach(slide => slide.classList.remove('active'));
            
            // Normalize slide index
            if (n >= totalSlides) currentSlide = 0;
            if (n < 0) currentSlide = totalSlides - 1;
            
            // Show current slide
            slides[currentSlide].classList.add('active');
            
            // Update counter
            document.getElementById('slideCounter').textContent = `${currentSlide + 1} / ${totalSlides}`;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentSlide === 0;
            document.getElementById('nextBtn').disabled = currentSlide === totalSlides - 1;
        }

        function changeSlide(direction) {
            currentSlide += direction;
            showSlide(currentSlide);
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowLeft') {
                changeSlide(-1);
            } else if (event.key === 'ArrowRight') {
                changeSlide(1);
            } else if (event.key === 'Home') {
                currentSlide = 0;
                showSlide(currentSlide);
            } else if (event.key === 'End') {
                currentSlide = totalSlides - 1;
                showSlide(currentSlide);
            }
        });

        // Initialize
        showSlide(0);
    </script>
</body>
</html>
                <!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Avan√ßado MongoDB - Aula 4</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            overflow: hidden;
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: stretch;
            justify-content: stretch;
            position: relative;
        }

        .slide {
            display: none;
            width: 100%;
            max-width: none;
            height: 100vh;
            padding: 40px 60px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 0;
            border: none;
            overflow-y: auto;
            animation: slideIn 0.5s ease-out;
            box-sizing: border-box;
        }

        .slide.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #fff, #a8d8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            font-size: 2.5rem;
            margin-bottom: 25px;
            color: #4ecdc4;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        h3 {
            font-size: 1.8rem;
            margin: 20px 0 15px;
            color: #ffd93d;
        }

        .emoji {
            font-size: 2rem;
        }

        .code-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4ecdc4;
        }

        .code-title {
            color: #4ecdc4;
            font-size: 1.1rem;
            margin-bottom: 10px;
            font-weight: bold;
        }

        pre {
            margin: 0 !important;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .concept-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border-left: 5px solid #ffd93d;
        }

        .concept-item {
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 3px solid #4ecdc4;
        }

        .concept-item strong {
            color: #4ecdc4;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        th {
            background: rgba(78, 205, 196, 0.3);
            color: #4ecdc4;
            font-weight: bold;
        }

        .navigation {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 1000;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .slide-counter {
            position: fixed;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .warning {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #ffb3b3;
        }

        .success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.5);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #c8e6c9;
        }

        .highlight {
            background: linear-gradient(120deg, rgba(255, 217, 61, 0.3) 0%, rgba(255, 217, 61, 0.1) 100%);
            padding: 2px 6px;
            border-radius: 4px;
            color: #ffd93d;
            font-weight: bold;
        }

        ul {
            margin: 20px 0;
            padding-left: 20px;
        }

        li {
            margin: 10px 0;
            line-height: 1.6;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .three-column {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .two-column, .three-column {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.8rem;
            }
            
            .slide {
                padding: 20px 30px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Slide 1: T√≠tulo -->
        <div class="slide active">
            <h1>CRUD Avan√ßado MongoDB</h1>
            <div style="text-align: center; margin: 40px 0;">
                <div style="font-size: 4rem; margin: 30px 0;">üöÄ</div>
                <h2 style="margin-bottom: 20px;">Opera√ß√µes Avan√ßadas & Relacionamentos</h2>
                <div style="font-size: 1.2rem; color: #a8d8ff; line-height: 1.6;">
                    <p>Agrega√ß√µes ‚Ä¢ Lookup ‚Ä¢ Ordena√ß√£o ‚Ä¢ Filtros Avan√ßados</p>
                    <p>Continuidade da Aula 3 - CRUD B√°sico</p>
                </div>
            </div>
            <div class="concept-box" style="margin-top: 50px;">
                <h3>üéØ O que voc√™ vai dominar:</h3>
                <ul>
                    <li>Cruzamento de cole√ß√µes (mesmo banco e bancos diferentes)</li>
                    <li>Filtros avan√ßados e operadores complexos</li>
                    <li>Ordena√ß√£o ASC/DESC e limita√ß√£o de resultados</li>
                    <li>Agrega√ß√µes e pipeline de dados</li>
                    <li>Indexa√ß√£o para performance</li>
                    <li>Implementa√ß√£o em Python avan√ßada</li>
                </ul>
            </div>
        </div>

        <!-- Slide 2: Prepara√ß√£o dos Dados -->
        <div class="slide">
            <h2><span class="emoji">üîß</span>Prepara√ß√£o - Criando Dados Relacionados</h2>
            
            <div class="concept-box">
                <p style="font-size: 1.2rem; margin-bottom: 20px;">
                    Vamos criar um sistema escolar com <span class="highlight">m√∫ltiplas cole√ß√µes relacionadas</span>:
                </p>
            </div>

            <div class="code-container">
                <div class="code-title">üè´ Cole√ß√£o: alunos</div>
                <pre><code class="language-javascript">db["alunos"].insertMany([
  {
    _id: ObjectId("507f1f77bcf86cd799439011"),
    nome: "Jo√£o Silva",
    idade: 20,
    curso_id: ObjectId("507f1f77bcf86cd799439021"),
    turma_id: ObjectId("507f1f77bcf86cd799439031"),
    notas: [8.5, 9.0, 7.5],
    ativo: true,
    data_matricula: new Date("2024-01-15")
  },
  {
    _id: ObjectId("507f1f77bcf86cd799439012"),
    nome: "Maria Santos",
    idade: 22,
    curso_id: ObjectId("507f1f77bcf86cd799439022"),
    turma_id: ObjectId("507f1f77bcf86cd799439032"),
    notas: [9.5, 8.0, 9.0],
    ativo: true,
    data_matricula: new Date("2024-02-01")
  }
])</code></pre>
            </div>

            <div class="two-column">
                <div>
                    <div class="code-container">
                        <div class="code-title">üìö Cole√ß√£o: cursos</div>
                        <pre><code class="language-javascript">// Classificar alunos
db.alunos.aggregate([
  {
    $addFields: {
      status: {
        $cond: {
          if: { $gte: [{ $avg: "$notas" }, 7] },
          then: "Aprovado",
          else: "Reprovado"
        }
      }
    }
  },
  {
    $group: {
      _id: "$status",
      count: { $sum: 1 }
    }
  }
])</code></pre>
                    </div>
                </div>
            </div>

            <div class="concept-box">
                <h3>üî• Operadores de Agrega√ß√£o √öteis:</h3>
                <ul>
                    <li><strong>$match:</strong> filtrar documentos (como WHERE)</li>
                    <li><strong>$group:</strong> agrupar e calcular (como GROUP BY)</li>
                    <li><strong>$project:</strong> selecionar campos (como SELECT)</li>
                    <li><strong>$sort:</strong> ordenar resultados</li>
                    <li><strong>$limit/$skip:</strong> pagina√ß√£o</li>
                    <li><strong>$lookup:</strong> JOIN entre cole√ß√µes</li>
                    <li><strong>$addFields:</strong> adicionar campos calculados</li>
                    <li><strong>$unwind:</strong> desestruturar arrays</li>
                    <li><strong>$bucket:</strong> agrupar por faixas de valores</li>
                </ul>
            </div>
        </div>

        <!-- Slide 8: Opera√ß√µes de Texto e Busca -->
        <div class="slide">
            <h2><span class="emoji">üîç</span>Busca Textual e Opera√ß√µes de String</h2>
            
            <div class="code-container">
                <div class="code-title">üìù Criando √çndice de Texto</div>
                <pre><code class="language-javascript">// Criar √≠ndice de texto em m√∫ltiplos campos
db.alunos.createIndex({
  nome: "text",
  curso: "text"
}, {
  default_language: "portuguese",
  name: "busca_texto_alunos"
})

// Busca textual simples
db.alunos.find({ $text: { $search: "Jo√£o Silva" } })

// Busca com frase exata
db.alunos.find({ $text: { $search: "\"Jo√£o Silva\"" } })

// Busca excluindo termos
db.alunos.find({ $text: { $search: "Jo√£o -Silva" } })</code></pre>
            </div>

            <div class="two-column">
                <div>
                    <div class="code-container">
                        <div class="code-title">üéØ Regex Avan√ßado</div>
                        <pre><code class="language-javascript">// Nomes que come√ßam com "J"
db.alunos.find({
  nome: { $regex: "^J", $options: "i" }
})

// Nomes que terminam com "Silva"
db.alunos.find({
  nome: { $regex: "Silva$", $options: "i" }
})

// Email v√°lido (padr√£o b√°sico)
db.alunos.find({
  email: {
    $regex: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
  }
})

// CPF com formata√ß√£o
db.alunos.find({
  cpf: { $regex: "^\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}$" }
})</code></pre>
                    </div>
                </div>
                <div>
                    <div class="code-container">
                        <div class="code-title">‚úÇÔ∏è Manipula√ß√£o de Strings</div>
                        <pre><code class="language-javascript">// Dividir nome em partes
db.alunos.aggregate([
  {
    $addFields: {
      primeiro_nome: {
        $arrayElemAt: [
          { $split: ["$nome", " "] }, 0
        ]
      },
      ultimo_nome: {
        $arrayElemAt: [
          { $split: ["$nome", " "] }, -1
        ]
      },
      iniciais: {
        $substr: ["$nome", 0, 1]
      },
      nome_upper: { $toUpper: "$nome" },
      nome_lower: { $toLower: "$nome" }
    }
  }
])</code></pre>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-title">üîé Busca Fuzzy (Aproximada) com Agrega√ß√£o</div>
                <pre><code class="language-javascript">db.alunos.aggregate([
  {
    $addFields: {
      score: {
        $cond: {
          if: { $regexMatch: { input: "$nome", regex: "Joao|Jo√£o", options: "i" } },
          then: 10,
          else: {
            $cond: {
              if: { $regexMatch: { input: "$nome", regex: "Jo", options: "i" } },
              then: 5,
              else: 0
            }
          }
        }
      }
    }
  },
  { $match: { score: { $gt: 0 } } },
  { $sort: { score: -1, nome: 1 } }
])</code></pre>
            </div>

            <div class="concept-box">
                <h3>üí° Dicas de Busca Textual:</h3>
                <ul>
                    <li><strong>√çndices de texto:</strong> Essenciais para performance em buscas</li>
                    <li><strong>L√≠ngua portuguesa:</strong> Configure default_language para melhor tokeniza√ß√£o</li>
                    <li><strong>Score de relev√¢ncia:</strong> Use { score: { $meta: "textScore" } } para ordenar por relev√¢ncia</li>
                    <li><strong>Regex vs Text Search:</strong> Regex para padr√µes espec√≠ficos, Text Search para busca natural</li>
                </ul>
            </div>
        </div>

        <!-- Slide 9: Opera√ß√µes de Data e Valida√ß√£o -->
        <div class="slide">
            <h2><span class="emoji">üìÖ</span>Opera√ß√µes de Data e Valida√ß√£o</h2>
            
            <div class="code-container">
                <div class="code-title">üìÖ Opera√ß√µes com Datas</div>
                <pre><code class="language-javascript">// Adicionar campos de data calculados
db.alunos.aggregate([
  {
    $addFields: {
      // Idade calculada pela data de nascimento
      idade_calculada: {
        $divide: [
          { $subtract: [new Date(), "$data_nascimento"] },
          365.25 * 24 * 60 * 60 * 1000  // milissegundos em um ano
        ]
      },
      
      // Ano de matr√≠cula
      ano_matricula: { $year: "$data_matricula" },
      
      // M√™s de matr√≠cula
      mes_matricula: { $month: "$data_matricula" },
      
      // Tempo desde matr√≠cula (em dias)
      dias_matriculado: {
        $divide: [
          { $subtract: [new Date(), "$data_matricula"] },
          24 * 60 * 60 * 1000  // milissegundos em um dia
        ]
      },
      
      // Data formatada
      data_formatada: {
        $dateToString: {
          format: "%d/%m/%Y",
          date: "$data_matricula"
        }
      }
    }
  }
])</code></pre>
            </div>

            <div class="two-column">
                <div>
                    <div class="code-container">
                        <div class="code-title">üéØ Filtros por Per√≠odo</div>
                        <pre><code class="language-javascript">// Matriculados no √∫ltimo m√™s
db.alunos.find({
  data_matricula: {
    $gte: new Date(Date.now() - 30*24*60*60*1000)
  }
})

// Matriculados em 2024
db.alunos.find({
  data_matricula: {
    $gte: new Date("2024-01-01"),
    $lt: new Date("2025-01-01")
  }
})

// Aniversariantes do m√™s
db.alunos.find({
  $expr: {
    $eq: [
      { $month: "$data_nascimento" },
      { $month: new Date() }
    ]
  }
})</code></pre>
                    </div>
                </div>
                <div>
                    <div class="code-container">
                        <div class="code-title">‚úÖ Valida√ß√£o de Dados</div>
                        <pre><code class="language-javascript">// Criar schema de valida√ß√£o
db.createCollection("alunos_validados", {
  validator: {
    $jsonSchema: {
      bsonType: "object",
      required: ["nome", "idade", "email"],
      properties: {
        nome: {
          bsonType: "string",
          minLength: 2,
          maxLength: 100
        },
        idade: {
          bsonType: "int",
          minimum: 16,
          maximum: 100
        },
        email: {
          bsonType: "string",
          pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
        },
        notas: {
          bsonType: "array",
          items: {
            bsonType: "double",
            minimum: 0,
            maximum: 10
          }
        }
      }
    }
  },
  validationAction: "error"
})</code></pre>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-title">üîç Encontrar Dados Inconsistentes</div>
                <pre><code class="language-javascript">// Alunos com dados problem√°ticos
db.alunos.aggregate([
  {
    $addFields: {
      problemas: {
        $concatArrays: [
          // Nome muito curto
          {
            $cond: [
              { $lt: [{ $strLenCP: "$nome" }, 2] },
              ["Nome muito curto"],
              []
            ]
          },
          // Idade fora do padr√£o
          {
            $cond: [
              { $or: [{ $lt: ["$idade", 16] }, { $gt: ["$idade", 100] }] },
              ["Idade inv√°lida"],
              []
            ]
          },
          // Sem notas
          {
            $cond: [
              { $eq: [{ $size: { $ifNull: ["$notas", []] } }, 0] },
              ["Sem notas"],
              []
            ]
          }
        ]
      }
    }
  },
  {
    $match: {
      $expr: { $gt: [{ $size: "$problemas" }, 0] }
    }
  },
  {
    $project: {
      nome: 1,
      idade: 1,
      notas: 1,
      problemas: 1
    }
  }
])</code></pre>
            </div>
        </div>

        <div class="slide">
            <h2><span class="emoji">üêç</span>Python Avan√ßado com PyMongo</h2>
            
            <div class="code-container">
                <div class="code-title">üöÄ Classe Completa para Gest√£o Escolar</div>
                <pre><code class="language-python">from pymongo import MongoClient, ASCENDING, DESCENDING
from bson import ObjectId
from datetime import datetime, timedelta
import re

class GestaoEscolar:
    def __init__(self, connection_string="mongodb://localhost:27017", db_name="escola"):
        self.client = MongoClient(connection_string)
        self.db = self.client[db_name]
        self.alunos = self.db["alunos"]
        self.cursos = self.db["cursos"]
        self.turmas = self.db["turmas"]
        
        # Criar √≠ndices automaticamente
        self._criar_indices()
    
    def _criar_indices(self):
        """Cria √≠ndices essenciais para performance"""
        try:
            # √çndices para alunos
            self.alunos.create_index([("nome", 1)])
            self.alunos.create_index([("curso_id", 1), ("ativo", 1)])
            self.alunos.create_index([("data_matricula", -1)])
            self.alunos.create_index([("nome", "text")])
            
            # √çndices para cursos
            self.cursos.create_index([("nome", 1)])
            self.cursos.create_index([("departamento", 1)])
            
            print("‚úÖ √çndices criados com sucesso!")
        except Exception as e:
            print(f"‚ö†Ô∏è Erro ao criar √≠ndices: {e}")
    
    def buscar_alunos_completo(self, filtros=None, ordenacao=None, limite=None, pagina=1):
        """
        Busca avan√ßada com filtros, ordena√ß√£o e pagina√ß√£o
        """
        pipeline = []
        
        # Aplicar filtros
        if filtros:
            pipeline.append({"$match": filtros})
        
        # Lookup com curso
        pipeline.extend([
            {
                "$lookup": {
                    "from": "cursos",
                    "localField": "curso_id",
                    "foreignField": "_id",
                    "as": "curso"
                }
            },
            {"$unwind": {"path": "$curso", "preserveNullAndEmptyArrays": True}},
            
            # Adicionar campos calculados
            {
                "$addFields": {
                    "media": {"$avg": "$notas"},
                    "total_notas": {"$size": {"$ifNull": ["$notas", []]}},
                    "curso_nome": {"$ifNull": ["$curso.nome", "Sem curso"]},
                    "departamento": {"$ifNull": ["$curso.departamento", "Sem departamento"]}
                }
            }
        ])
        
        # Aplicar ordena√ß√£o
        if ordenacao:
            pipeline.append({"$sort": ordenacao})
        else:
            pipeline.append({"$sort": {"nome": 1}})
        
        # Pagina√ß√£o
        if limite:
            skip = (pagina - 1) * limite
            pipeline.extend([
                {"$skip": skip},
                {"$limit": limite}
            ])
        
        return list(self.alunos.aggregate(pipeline))
    
    def estatisticas_gerais(self):
        """Gera relat√≥rio completo de estat√≠sticas"""
        pipeline = [
            {
                "$facet": {
                    # Estat√≠sticas por curso
                    "por_curso": [
                        {"$match": {"ativo": True}},
                        {
                            "$group": {
                                "_id": "$curso_id",
                                "total_alunos": {"$sum": 1},
                                "media_idade": {"$avg": "$idade"},
                                "media_notas": {"$avg": {"$avg": "$notas"}}
                            }
                        },
                        {
                            "$lookup": {
                                "from": "cursos",
                                "localField": "_id",
                                "foreignField": "_id",
                                "as": "curso"
                            }
                        },
                        {"$unwind": "$curso"},
                        {
                            "$project": {
                                "curso_nome": "$curso.nome",
                                "departamento": "$curso.departamento",
                                "total_alunos": 1,
                                "media_idade": {"$round": ["$media_idade", 1]},
                                "media_notas": {"$round": ["$media_notas", 2]}
                            }
                        }
                    ],
                    
                    # Distribui√ß√£o por faixa et√°ria
                    "por_idade": [
                        {
                            "$bucket": {
                                "groupBy": "$idade",
                                "boundaries": [16, 20, 25, 30, 40],
                                "default": "40+",
                                "output": {
                                    "count": {"$sum": 1},
                                    "media_notas": {"$avg": {"$avg": "$notas"}}
                                }
                            }
                        }
                    ],
                    
                    # Alunos por status
                    "por_status": [
                        {
                            "$addFields": {
                                "status": {
                                    "$cond": {
                                        "if": {"$gte": [{"$avg": "$notas"}, 7]},
                                        "then": "Aprovado",
                                        "else": "Reprovado"
                                    }
                                }
                            }
                        },
                        {
                            "$group": {
                                "_id": "$status",
                                "count": {"$sum": 1}
                            }
                        }
                    ]
                }
            }
        ]
        
        resultado = list(self.alunos.aggregate(pipeline))[0]
        return resultado
    
    def busca_textual_avancada(self, termo_busca, incluir_curso=True):
        """Busca textual avan√ßada com score de relev√¢ncia"""
        pipeline = [
            {"$match": {"$text": {"$search": termo_busca}}},
            {"$addFields": {"score": {"$meta": "textScore"}}},
        ]
        
        if incluir_curso:
            pipeline.extend([
                {
                    "$lookup": {
                        "from": "cursos",
                        "localField": "curso_id",
                        "foreignField": "_id",
                        "as": "curso"
                    }
                },
                {"$unwind": {"path": "$curso", "preserveNullAndEmptyArrays": True}}
            ])
        
        pipeline.extend([
            {"$sort": {"score": {"$meta": "textScore"}, "nome": 1}},
            {
                "$project": {
                    "nome": 1,
                    "idade": 1,
                    "curso_nome": {"$ifNull": ["$curso.nome", "Sem curso"]},
                    "media": {"$avg": "$notas"},
                    "score": 1
                }
            }
        ])
        
        return list(self.alunos.aggregate(pipeline))
    
    def relatorio_mensal(self, ano=None, mes=None):
        """Relat√≥rio de matr√≠culas por m√™s"""
        if not ano:
            ano = datetime.now().year
        if not mes:
            mes = datetime.now().month
        
        inicio_mes = datetime(ano, mes, 1)
        if mes == 12:
            fim_mes = datetime(ano + 1, 1, 1)
        else:
            fim_mes = datetime(ano, mes + 1, 1)
        
        pipeline = [
            {
                "$match": {
                    "data_matricula": {
                        "$gte": inicio_mes,
                        "$lt": fim_mes
                    }
                }
            },
            {
                "$lookup": {
                    "from": "cursos",
                    "localField": "curso_id",
                    "foreignField": "_id",
                    "as": "curso"
                }
            },
            {"$unwind": "$curso"},
            {
                "$group": {
                    "_id": {
                        "curso": "$curso.nome",
                        "dia": {"$dayOfMonth": "$data_matricula"}
                    },
                    "count": {"$sum": 1},
                    "alunos": {"$push": "$nome"}
                }
            },
            {"$sort": {"_id.dia": 1, "_id.curso": 1}}
        ]
        
        return list(self.alunos.aggregate(pipeline))

# Exemplo de uso
escola = GestaoEscolar()

# Busca com filtros avan√ßados
alunos = escola.buscar_alunos_completo(
    filtros={"ativo": True, "idade": {"$gte": 20}},
    ordenacao={"media": -1, "nome": 1},
    limite=10,
    pagina=1
)

# Estat√≠sticas gerais
stats = escola.estatisticas_gerais()

# Busca textual
resultados = escola.busca_textual_avancada("Jo√£o Silva")

print("üéì Sistema de Gest√£o Escolar funcionando!")</code></pre>
            </div>
        </div>

        <!-- Slide 11: Indexa√ß√£o e Performance -->
        <div class="slide">
            <h2><span class="emoji">üêç</span>Python Avan√ßado com PyMongo</h2>
            
            <div class="code-container">
                <div class="code-title">üöÄ Implementa√ß√£o completa em Python</div>
                <pre><code class="language-python">from pymongo import MongoClient
from bson import ObjectId
from datetime import datetime, timedelta

class EscolaDB:
    def __init__(self, connection_string="mongodb://localhost:27017"):
        self.client = MongoClient(connection_string)
        self.db = self.client["escola"]
        self.alunos = self.db["alunos"]
        self.cursos = self.db["cursos"]
        self.turmas = self.db["turmas"]
    
    def buscar_alunos_com_curso(self, filtro=None):
        """Busca alunos com dados do curso (lookup)"""
        pipeline = [
            {"$match": filtro or {}},
            {
                "$lookup": {
                    "from": "cursos",
                    "localField": "curso_id",
                    "foreignField": "_id",
                    "as": "curso"
                }
            },
            {"$unwind": "$curso"},
            {
                "$project": {
                    "nome": 1,
                    "idade": 1,
                    "curso_nome": "$curso.nome",
                    "departamento": "$curso.departamento",
                    "media": {"$avg": "$notas"}
                }
            }
        ]
        return list(self.alunos.aggregate(pipeline))
    
    def estatisticas_por_curso(self):
        """Estat√≠sticas detalhadas por curso"""
        pipeline = [
            {"$match": {"ativo": True}},
            {
                "$addFields": {
                    "media_individual": {"$avg": "$notas"}
                }
            },
            {
                "$group": {
                    "_id": "$curso_id",
                    "total_alunos": {"$sum": 1},
                    "idade_media": {"$avg": "$idade"},
                    "media_geral": {"$avg": "$media_individual"},
                    "melhor_nota": {"$max": "$media_individual"}
                }
            },
            {
                "$lookup": {
                    "from": "cursos",
                    "localField": "_id",
                    "foreignField": "_id",
                    "as": "curso_info"
                }
            },
            {"$sort": {"media_geral": -1}}
        ]
        return list(self.alunos.aggregate(pipeline))
    
    def buscar_com_filtros_avancados(self, **kwargs):
        """Busca com m√∫ltiplos filtros"""
        filtro = {}
        
        # Filtro por idade (range)
        if 'idade_min' in kwargs or 'idade_max' in kwargs:
            filtro['idade'] = {}
            if 'idade_min' in kwargs:
                filtro['idade']['$gte'] = kwargs['idade_min']
            if 'idade_max' in kwargs:
                filtro['idade']['$lte'] = kwargs['idade_max']
        
        # Filtro por nome (regex)
        if 'nome_parcial' in kwargs:
            filtro['nome'] = {"$regex": kwargs['nome_parcial'], "$options": "i"}
        
        # Filtro por status
        if 'ativo' in kwargs:
            filtro['ativo'] = kwargs['ativo']
        
        # Ordena√ß√£o e limita√ß√£o
        ordenacao = kwargs.get('ordenar_por', 'nome')
        ordem = kwargs.get('ordem', 1)  # 1 = ASC, -1 = DESC
        limite = kwargs.get('limite', 0)
        
        cursor = self.alunos.find(filtro).sort(ordenacao, ordem)
        if limite > 0:
            cursor = cursor.limit(limite)
            
        return list(cursor)

# Exemplo de uso
escola = EscolaDB()

# Buscar alunos de Engenharia com idade entre 20-25
resultado = escola.buscar_com_filtros_avancados(
    nome_parcial="Silva",
    idade_min=20,
    idade_max=25,
    ativo=True,
    ordenar_por="idade",
    ordem=-1,
    limite=10
)

print(resultado)</code></pre>
            </div>
        </div>

        <!-- Slide 9: Indexa√ß√£o e Performance -->
        <div class="slide">
            <h2><span class="emoji">‚ö°</span>Indexa√ß√£o e Performance</h2>
            
            <div class="concept-box">
                <p style="font-size: 1.2rem; margin-bottom: 20px;">
                    <span class="highlight">√çndices</span> s√£o fundamentais para consultas r√°pidas em grandes volumes de dados!
                </p>
            </div>

            <div class="code-container">
                <div class="code-title">üìà Criando √çndices Essenciais</div>
                <pre><code class="language-javascript">// √çndice simples (campo √∫nico)
db.alunos.createIndex({ nome: 1 })
db.alunos.createIndex({ idade: -1 })
db.alunos.createIndex({ data_matricula: -1 })

// √çndice composto (m√∫ltiplos campos)
db.alunos.createIndex({ curso_id: 1, ativo: 1 })
db.alunos.createIndex({ ativo: 1, idade: -1 })

// √çndice de texto para busca textual
db.alunos.createIndex({ nome: "text", curso: "text" })

// √çndice esparso (s√≥ para docs que t√™m o campo)
db.alunos.createIndex({ telefone: 1 }, { sparse: true })</code></pre>
            </div>

            <div class="two-column">
                <div>
                    <div class="code-container">
                        <div class="code-title">üîç Analisando Performance</div>
                        <pre><code class="language-javascript">// Ver plano de execu√ß√£o
db.alunos.find({ idade: { $gt: 20 } })
  .explain("executionStats")

// Verificar √≠ndices existentes
db.alunos.getIndexes()

// Estat√≠sticas de uso de √≠ndices
db.alunos.aggregate([
  { $indexStats: {} }
])</code></pre>
                    </div>
                </div>
                <div>
                    <div class="code-container">
                        <div class="code-title">üßπ Manuten√ß√£o de √çndices</div>
                        <pre><code class="language-javascript">// Remover √≠ndice
db.alunos.dropIndex({ nome: 1 })

// Recriar todos os √≠ndices
db.alunos.reIndex()

// Compactar cole√ß√£o
db.runCommand({ compact: "alunos" })</code></pre>
                    </div>
                </div>
            </div>

            <div class="concept-box">
                <h3>üéØ Boas Pr√°ticas de Indexa√ß√£o:</h3>
                <ul>
                    <li><strong>Campos de consulta frequente:</strong> Sempre indexe campos usados em find()</li>
                    <li><strong>Ordem do √≠ndice composto:</strong> Campo mais seletivo primeiro</li>
                    <li><strong>√çndices de ordena√ß√£o:</strong> Crie √≠ndices para campos de sort()</li>
                    <li><strong>Monitore performance:</strong> Use explain() para verificar se √≠ndices s√£o usados</li>
                    <li><strong>N√£o exagere:</strong> Muitos √≠ndices impactam inser√ß√µes e updates</li>
                </ul>
            </div>
        </div>

        <!-- Slide 10: Resumo e Pr√≥ximos Passos -->
        <div class="slide">
            <h2><span class="emoji">üéì</span>Resumo e Pr√≥ximos Passos</h2>
            
            <div class="concept-box">
                <h3>‚úÖ O que voc√™ domina agora:</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <h4 style="color: #4ecdc4; margin-bottom: 15px;">üîó Relacionamentos</h4>
                        <ul>
                            <li>‚úÖ Lookup entre cole√ß√µes ($lookup)</li>
                            <li>‚úÖ Cruzamento de dados entre bancos</li>
                            <li>‚úÖ Pipeline de agrega√ß√£o avan√ßado</li>
                        </ul>

                        <h4 style="color: #4ecdc4; margin: 20px 0 15px;">üéØ Filtros Avan√ßados</h4>
                        <ul>
                            <li>‚úÖ Operadores de compara√ß√£o ($gt, $in, etc.)</li>
                            <li>‚úÖ Regex e busca textual</li>
                            <li>‚úÖ Filtros de array e data</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #4ecdc4; margin-bottom: 15px;">üìä Ordena√ß√£o e Agrega√ß√£o</h4>
                        <ul>
                            <li>‚úÖ Sort ASC/DESC e m√∫ltiplos campos</li>
                            <li>‚úÖ Limit, skip e pagina√ß√£o</li>
                            <li>‚úÖ Estat√≠sticas e agrupamentos</li>
                        </ul>

                        <h4 style="color: #4ecdc4; margin: 20px 0 15px;">‚ö° Performance</h4>
                        <ul>
                            <li>‚úÖ Cria√ß√£o e gest√£o de √≠ndices</li>
                            <li>‚úÖ An√°lise de performance com explain()</li>
                            <li>‚úÖ Implementa√ß√£o otimizada em Python</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="concept-box" style="margin-top: 30px;">
                <h3>üöÄ Pr√≥ximos N√≠veis para Explorar:</h3>
                <div class="concept-item">
                    <strong>üîÑ Transa√ß√µes:</strong> ACID compliance para opera√ß√µes cr√≠ticas
                </div>
                <div class="concept-item">
                    <strong>üåê Replica√ß√£o:</strong> Alta disponibilidade com replica sets
                </div>
                <div class="concept-item">
                    <strong>üìà Sharding:</strong> Escalabilidade horizontal para big data
                </div>
                <div class="concept-item">
                    <strong>üîí Seguran√ßa:</strong> Autentica√ß√£o, autoriza√ß√£o e criptografia
                </div>
                <div class="concept-item">
                    <strong>üé® MongoDB Atlas:</strong> Banco como servi√ßo na nuvem
                </div>
                <div class="concept-item">
                    <strong>üß† Machine Learning:</strong> Integra√ß√£o com frameworks de ML
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px; font-size: 1.2rem;">
                <p style="color: #4ecdc4;">üéâ <strong>Excelente!</strong> Voc√™ agora domina MongoDB avan√ßado!</p>
                <p style="margin-top: 15px; color: #a8d8ff;">Continue praticando com projetos reais para fixar o conhecimento</p>
                <div style="margin-top: 25px; font-size: 2rem;">üöÄüìäüî•</div>
            </div>
        </div>
    </div>

    <!-- Navega√ß√£o -->
    <div class="navigation">
        <button class="nav-btn" id="prevBtn" onclick="changeSlide(-1)">‚Üê Anterior</button>
        <button class="nav-btn" id="nextBtn" onclick="changeSlide(1)">Pr√≥ximo ‚Üí</button>
    </div>

    <!-- Contador de slides -->
    <div class="slide-counter">
        <span id="slideCounter">1 / 10</span>
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;

        function showSlide(n) {
            // Remove active class from all slides
            slides.forEach(slide => slide.classList.remove('active'));
            
            // Normalize slide index
            if (n >= totalSlides) currentSlide = 0;
            if (n < 0) currentSlide = totalSlides - 1;
            
            // Show current slide
            slides[currentSlide].classList.add('active');
            
            // Update counter
            document.getElementById('slideCounter').textContent = `${currentSlide + 1} / ${totalSlides}`;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentSlide === 0;
            document.getElementById('nextBtn').disabled = currentSlide === totalSlides - 1;
        }

        function changeSlide(direction) {
            currentSlide += direction;
            showSlide(currentSlide);
        }

        // Keyboard navigation
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowLeft') {
                changeSlide(-1);
            } else if (event.key === 'ArrowRight') {
                changeSlide(1);
            } else if (event.key === 'Home') {
                currentSlide = 0;
                showSlide(currentSlide);
            } else if (event.key === 'End') {
                currentSlide = totalSlides - 1;
                showSlide(currentSlide);
            }
        });

        // Initialize
        showSlide(0);
    </script>
</body>
</html>="language-javascript">db["cursos"].insertMany([
  {
    _id: ObjectId("507f1f77bcf86cd799439021"),
    nome: "Engenharia Software",
    departamento: "Exatas",
    duracao_semestres: 8,
    coordenador: "Prof. Carlos"
  },
  {
    _id: ObjectId("507f1f77bcf86cd799439022"),
    nome: "Medicina",
    departamento: "Sa√∫de",
    duracao_semestres: 12,
    coordenador: "Prof. Ana"
  }
])</code></pre>
                    </div>
                </div>
                <div>
                    <div class="code-container">
                        <div class="code-title">üë• Cole√ß√£o: turmas</div>
                        <pre><code class="language-javascript">db["turmas"].insertMany([
  {
    _id: ObjectId("507f1f77bcf86cd799439031"),
    codigo: "ENG2024A",
    semestre: "2024.1",
    vagas: 40,
    curso_id: ObjectId("507f1f77bcf86cd799439021")
  },
  {
    _id: ObjectId("507f1f77bcf86cd799439032"),
    codigo: "MED2024B",
    semestre: "2024.1",
    vagas: 50,
    curso_id: ObjectId("507f1f77bcf86cd799439022")
  }
])</code></pre>
                    </div>
                </div>
            </div>

            <div class="success">
                <strong>‚úÖ Pronto!</strong> Agora temos um sistema com relacionamentos: alunos ‚Üî cursos ‚Üî turmas
            </div>
        </div>

        <!-- Slide 3: Lookup - Cruzamento de Cole√ß√µes -->
        <div class="slide">
            <h2><span class="emoji">üîó</span>Lookup - Cruzamento de Cole√ß√µes</h2>
            
            <div class="code-container">
                <div class="code-title">üéØ Buscar alunos COM dados do curso</div>
                <pre><code class="language-javascript">db["alunos"].aggregate([
  {
    $lookup: {
      from: "cursos",           // cole√ß√£o para fazer join
      localField: "curso_id",   // campo local (alunos)
      foreignField: "_id",      // campo da cole√ß√£o externa (cursos)
      as: "dados_curso"         // nome do array resultado
    }
  },
  {
    $unwind: "$dados_curso"     // transforma array em objeto
  },
  {
    $project: {
      nome: 1,
      idade: 1,
      "curso_nome": "$dados_curso.nome",
      "departamento": "$dados_curso.departamento",
      "coordenador": "$dados_curso.coordenador"
    }
  }
])</code></pre>
            </div>

            <div class="code-container">
                <div class="code-title">üéØ Lookup com m√∫ltiplas cole√ß√µes (aluno + curso + turma)</div>
                <pre><code class="language-javascript">db["alunos"].aggregate([
  // Join com cursos
  {
    $lookup: {
      from: "cursos",
      localField: "curso_id",
      foreignField: "_id",
      as: "curso"
    }
  },
  // Join com turmas
  {
    $lookup: {
      from: "turmas",
      localField: "turma_id",
      foreignField: "_id",
      as: "turma"
    }
  },
  // Transformar arrays em objetos
  { $unwind: "$curso" },
  { $unwind: "$turma" },
  // Proje√ß√£o final
  {
    $project: {
      nome: 1,
      idade: 1,
      "curso_nome": "$curso.nome",
      "turma_codigo": "$turma.codigo",
      "semestre": "$turma.semestre",
      media: { $avg: "$notas" }
    }
  }
])</code></pre>
            </div>

            <div class="concept-box">
                <h3>üß† Conceitos importantes:</h3>
                <ul>
                    <li><strong>$lookup:</strong> faz "JOIN" entre cole√ß√µes (como SQL)</li>
                    <li><strong>$unwind:</strong> converte array em objetos separados</li>
                    <li><strong>$project:</strong> seleciona e renomeia campos</li>
                    <li><strong>Pipeline:</strong> sequ√™ncia de opera√ß√µes (como um funil)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 4: Lookup Entre Bancos Diferentes -->
        <div class="slide">
            <h2><span class="emoji">üóÑÔ∏è</span>Lookup Entre Bancos Diferentes</h2>
            
            <div class="warning">
                <strong>‚ö†Ô∏è Limita√ß√£o:</strong> MongoDB n√£o suporta lookup direto entre bancos diferentes. Mas temos alternativas!
            </div>

            <div class="concept-box">
                <h3>üí° Estrat√©gias para cruzar dados entre bancos:</h3>
            </div>

            <div class="two-column">
                <div>
                    <h3>üêç Solu√ß√£o em Python</h3>
                    <div class="code-container">
                        <div class="code-title">Cruzamento manual com PyMongo</div>
                        <pre><code class="language-python">from pymongo import MongoClient

# Conex√µes com bancos diferentes
client = MongoClient("mongodb://localhost:27017")
db_escola = client["escola"]
db_biblioteca = client["biblioteca"]

# Buscar alunos
alunos = list(db_escola["alunos"].find())

# Para cada aluno, buscar empr√©stimos
for aluno in alunos:
    emprestimos = list(db_biblioteca["emprestimos"].find({
        "aluno_id": aluno["_id"]
    }))
    aluno["emprestimos"] = emprestimos

# Resultado: alunos com seus empr√©stimos
print(alunos)</code></pre>
                    </div>
                </div>
                <div>
                    <h3>üîÑ Usando Views (MongoDB 3.4+)</h3>
                    <div class="code-container">
                        <div class="code-title">Criar view no banco principal</div>
                        <pre><code class="language-javascript">// No banco "escola"
db.createView(
  "alunos_com_biblioteca",
  "alunos",
  [
    {
      $lookup: {
        from: "dados_biblioteca", // cole√ß√£o espelho
        localField: "_id",
        foreignField: "aluno_id",
        as: "emprestimos"
      }
    }
  ]
)</code></pre>
                    </div>
                    <div class="concept-item">
                        <strong>üí≠ Ideia:</strong> Sincronizar dados relevantes entre bancos usando scripts automatizados
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-title">üöÄ Solu√ß√£o Avan√ßada: Pipeline Python para m√∫ltiplos bancos</div>
                <pre><code class="language-python">def buscar_dados_completos(aluno_id):
    # Banco escola
    aluno = db_escola["alunos"].find_one({"_id": aluno_id})
    curso = db_escola["cursos"].find_one({"_id": aluno["curso_id"]})
    
    # Banco biblioteca
    emprestimos = list(db_biblioteca["emprestimos"].find({"aluno_id": aluno_id}))
    
    # Banco financeiro
    client_financeiro = MongoClient("mongodb://servidor2:27017")
    db_financeiro = client_financeiro["financeiro"]
    mensalidades = list(db_financeiro["pagamentos"].find({"aluno_id": aluno_id}))
    
    # Combinar tudo
    return {
        "aluno": aluno,
        "curso": curso,
        "emprestimos": emprestimos,
        "situacao_financeira": mensalidades
    }</code></pre>
            </div>
        </div>

        <!-- Slide 5: Filtros Avan√ßados -->
        <div class="slide">
            <h2><span class="emoji">üéØ</span>Filtros Avan√ßados e Operadores</h2>
            
            <div class="three-column">
                <div>
                    <h3>üìä Operadores de Compara√ß√£o</h3>
                    <div class="code-container">
                        <pre><code class="language-javascript">// Idade entre 18 e 25
db.alunos.find({
  idade: { $gte: 18, $lte: 25 }
})

// Nome N√ÉO √© "Jo√£o"
db.alunos.find({
  nome: { $ne: "Jo√£o Silva" }
})

// Curso em lista espec√≠fica
db.alunos.find({
  curso_id: { 
    $in: [
      ObjectId("..."),
      ObjectId("...")
    ]
  }
})</code></pre>
                    </div>
                </div>
                <div>
                    <h3>üî§ Operadores de Texto</h3>
                    <div class="code-container">
                        <pre><code class="language-javascript">// Busca por regex (parcial)
db.alunos.find({
  nome: { $regex: "Silva", $options: "i" }
})

// Campo existe
db.alunos.find({
  telefone: { $exists: true }
})

// Tipo espec√≠fico
db.alunos.find({
  idade: { $type: "number" }
})</code></pre>
                    </div>
                </div>
                <div>
                    <h3>üìã Operadores de Array</h3>
                    <div class="code-container">
                        <pre><code class="language-javascript">// Array tem tamanho espec√≠fico
db.alunos.find({
  notas: { $size: 3 }
})

// Pelo menos uma nota > 9
db.alunos.find({
  notas: { $elemMatch: { $gt: 9 } }
})

// Todas as notas > 7
db.alunos.find({
  notas: { $not: { $elemMatch: { $lte: 7 } } }
})</code></pre>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-title">üßÆ Filtros com Operadores L√≥gicos</div>
                <pre><code class="language-javascript">// AND impl√≠cito (padr√£o)
db.alunos.find({
  idade: { $gte: 20 },
  ativo: true
})

// OR expl√≠cito
db.alunos.find({
  $or: [
    { idade: { $lt: 18 } },
    { idade: { $gt: 30 } }
  ]
})

// Combina√ß√£o complexa: (ativo = true) E (idade > 18 OU tem bolsa)
db.alunos.find({
  ativo: true,
  $or: [
    { idade: { $gt: 18 } },
    { bolsa_estudos: { $exists: true } }
  ]
})</code></pre>
            </div>

            <div class="code-container">
                <div class="code-title">üìÖ Filtros de Data</div>
                <pre><code class="language-javascript">// Matriculados em 2024
db.alunos.find({
  data_matricula: {
    $gte: new Date("2024-01-01"),
    $lt: new Date("2025-01-01")
  }
})

// √öltimos 30 dias
db.alunos.find({
  data_matricula: {
    $gte: new Date(Date.now() - 30*24*60*60*1000)
  }
})</code></pre>
            </div>
        </div>

        <!-- Slide 6: Ordena√ß√£o e Limita√ß√£o -->
        <div class="slide">
            <h2><span class="emoji">üìà</span>Ordena√ß√£o ASC/DESC e Limita√ß√£o</h2>
            
            <div class="two-column">
                <div>
                    <h3>‚¨ÜÔ∏è‚¨áÔ∏è Ordena√ß√£o Simples</h3>
                    <div class="code-container">
                        <div class="code-title">Crescente (ASC) = 1</div>
                        <pre><code class="language-javascript">// Por idade (menor para maior)
db.alunos.find().sort({ idade: 1 })

// Por nome (A para Z)
db.alunos.find().sort({ nome: 1 })</code></pre>
                    </div>
                    
                    <div class="code-container">
                        <div class="code-title">Decrescente (DESC) = -1</div>
                        <pre><code class="language-javascript">// Por idade (maior para menor)
db.alunos.find().sort({ idade: -1 })

// Por data (mais recente primeiro)
db.alunos.find().sort({ 
  data_matricula: -1 
})</code></pre>
                    </div>
                </div>
                <div>
                    <h3>üéØ Ordena√ß√£o M√∫ltipla</h3>
                    <div class="code-container">
                        <div class="code-title">M√∫ltiplos campos</div>
                        <pre><code class="language-javascript">// 1¬∫ por curso, depois por idade
db.alunos.find().sort({
  curso_id: 1,
  idade: -1
})

// 1¬∫ por ativo, 2¬∫ por nota m√©dia
db.alunos.aggregate([
  {
    $addFields: {
      media: { $avg: "$notas" }
    }
  },
  {
    $sort: {
      ativo: -1,    // ativos primeiro
      media: -1     // melhores notas primeiro
    }
  }
])</code></pre>
                    </div>
                </div>
            </div>

            <div class="code-container">
                <div class="code-title">üìã Limita√ß√£o e Pagina√ß√£o</div>
                <pre><code class="language-javascript">// Apenas os 5 primeiros
db.alunos.find().limit(5)

// Pular 10 e pegar os pr√≥ximos 5 (p√°gina 3, tamanho 5)
db.alunos.find().skip(10).limit(5)

// Top 3 alunos por m√©dia (pipeline)
db.alunos.aggregate([
  {
    $addFields: {
      media: { $avg: "$notas" }
    }
  },
  {
    $sort: { media: -1 }
  },
  {
    $limit: 3
  },
  {
    $project: {
      nome: 1,
      media: 1,
      _id: 0
    }
  }
])</code></pre>
            </div>

            <div class="concept-box">
                <h3>‚ö° Dicas de Performance:</h3>
                <ul>
                    <li><strong>√çndices:</strong> Crie √≠ndices nos campos de ordena√ß√£o para speed</li>
                    <li><strong>Limit sempre:</strong> Use limit() para evitar resultados gigantes</li>
                    <li><strong>Pipeline otimizado:</strong> $match antes de $sort quando poss√≠vel</li>
                </ul>
            </div>
        </div>

        <!-- Slide 7: Agrega√ß√µes Avan√ßadas -->
        <div class="slide">
            <h2><span class="emoji">üßÆ</span>Agrega√ß√µes e Pipeline Avan√ßado</h2>
            
            <div class="code-container">
                <div class="code-title">üìä Estat√≠sticas por Curso</div>
                <pre><code class="language-javascript">db.alunos.aggregate([
  // Filtrar apenas alunos ativos
  { $match: { ativo: true } },
  
  // Calcular m√©dia individual
  {
    $addFields: {
      media_individual: { $avg: "$notas" }
    }
  },
  
  // Agrupar por curso
  {
    $group: {
      _id: "$curso_id",
      total_alunos: { $sum: 1 },
      idade_media: { $avg: "$idade" },
      media_geral: { $avg: "$media_individual" },
      melhor_nota: { $max: "$media_individual" },
      pior_nota: { $min: "$media_individual" }
    }
  },
  
  // Adicionar dados do curso
  {
    $lookup: {
      from: "cursos",
      localField: "_id",
      foreignField: "_id",
      as: "curso_info"
    }
  },
  
  // Estruturar resultado final
  {
    $project: {
      curso_nome: { $arrayElemAt: ["$curso_info.nome", 0] },
      total_alunos: 1,
      idade_media: { $round: ["$idade_media", 1] },
      media_geral: { $round: ["$media_geral", 2] },
      melhor_nota: { $round: ["$melhor_nota", 2] },
      pior_nota: { $round: ["$pior_nota", 2] }
    }
  },
  
  // Ordenar por m√©dia geral
  { $sort: { media_geral: -1 } }
])</code></pre>
            </div>

            <div class="two-column">
                <div>
                    <div class="code-container">
                        <div class="code-title">üìà Contagem e Agrupamento</div>
                        <pre><code class="language-javascript">// Alunos por faixa et√°ria
db.alunos.aggregate([
  {
    $bucket: {
      groupBy: "$idade",
      boundaries: [18, 21, 25, 30],
      default: "30+",
      output: {
        count: { $sum: 1 },
        nomes: { $push: "$nome" }
      }
    }
  }
])</code></pre>
                    </div>
                </div>
                <div>
                    <div class="code-container">
                        <div class="code-title">üéØ Filtros Condicionais</div>
                        <pre><code class